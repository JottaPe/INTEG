import{Observable}from"rxjs/Observable";import"rxjs/add/operator/map";import"rxjs/add/operator/catch";var ThfI18nBaseService=function(){function t(t,e){this.config=t,this.http=e,this.varI18n={},this.useCache=!1,this.servicesContext={},this.setConfig(t)}return t.prototype.setConfig=function(t){if(t.default&&(t.default.language?this.languageDefault=t.default.language.toLowerCase():this.languageDefault=navigator.language.toLowerCase(),this.contextDefault=t.default.context?t.default.context:"",this.useCache=!!t.default.cache&&t.default.cache),t.contexts&&(this.setVarI18n(t.contexts),!this.contextDefault))for(var e in t.contexts)if(this.config.contexts.hasOwnProperty(e)){this.contextDefault=e;break}},t.prototype.getLiterals=function(t){var e=this;void 0===t&&(t={});var r=t.language?t.language.toLowerCase():this.languageDefault.toLowerCase(),a=t.context?t.context:this.contextDefault,n=t.literals?t.literals:[];return new Observable(function(t){e.servicesContext[a]?e.getLiteralsFromContextService(r,a,n,t):e.getLiteralsFromContextConstant(r,a,n,t)})},t.prototype.getLiteralsFromContextService=function(t,e,r,a,n,o){void 0===n&&(n={}),void 0===o&&(o=null);var s=o||t;n=this.mergeObject(n,this.searchInVarI18n(s,e,r)),this.countObject(n)>0&&a.next(n),r.length>0?r.length>this.countObject(n)&&this.getLiteralsLocalStorageAndCache(s,e,r,a,n,o):this.getLiteralsLocalStorageAndCache(s,e,r,a,n,o)},t.prototype.getLiteralsLocalStorageAndCache=function(t,e,r,a,n,o){var s=this;void 0===o&&(o=null);var i,c=o||t;this.useCache&&(i=this.searchInLocalStorage(c,e,r),this.countObject(i)>0&&(this.updateVarI18n(t,e,i),n=this.mergeObject(n,i),a.next(n))),this.getHttpService(this.servicesContext[e],c,r).subscribe(function(c){c&&(s.updateLocalStorage(t,e,c),s.updateVarI18n(t,e,c),i=s.searchInVarI18n(t,e,r),n=s.mergeObject(n,i),a.next(n)),r.length>s.countObject(n)&&("pt-br"===o?(n=s.completeFaultLiterals(t,e,r,n),s.updateLocalStorage(t,e,n),s.updateVarI18n(t,e,n),a.next(n)):s.getLiteralsFromContextService(t,e,r,a,n,"pt-br"))})},t.prototype.getLiteralsFromContextConstant=function(t,e,r,a,n){void 0===n&&(n={}),n=this.mergeObject(n,this.searchInVarI18n(t,e,r)),this.countObject(n)>0&&a.next(n),r.length>0?r.length>this.countObject(n)&&("pt-br"===t?(n=this.completeFaultLiterals(t,e,r,n),a.next(n)):this.getLiteralsFromContextConstant("pt-br",e,r,a,n)):0===this.countObject(n)&&"pt-br"!==t&&this.getLiteralsFromContextConstant("pt-br",e,r,a,n)},t.prototype.searchInLocalStorage=function(t,e,r){var a={};if(r.length>0)for(var n=0;n<r.length;n++){var o=r[n],s=localStorage.getItem(t+"-"+e+"-"+o);s&&(a[o]=s)}return a},t.prototype.searchInVarI18n=function(t,e,r){var a={};if(this.varI18n[t]&&this.varI18n[t][e]){var n=this.varI18n[t][e];if(r.length>0)for(var o=0;o<r.length;o++){var s=r[o];n.hasOwnProperty(s)&&(a[s]=n[s])}else a=n}return a},t.prototype.updateLocalStorage=function(t,e,r){if(this.useCache)for(var a in r)r.hasOwnProperty(a)&&localStorage.setItem(t+"-"+e+"-"+a,r[a])},t.prototype.setVarI18n=function(t){for(var e in t)if(t.hasOwnProperty(e)){t[e];for(var r in t[e])if(t[e].hasOwnProperty(r)){var a=t[e][r];"url"===r?this.servicesContext[e]=a:this.updateVarI18n(r,e,a)}}},t.prototype.updateVarI18n=function(t,e,r){t=t.toLowerCase(),this.varI18n[t]||(this.varI18n[t]=(a={},a[e]={},a)),this.varI18n[t][e]||(this.varI18n[t][e]={}),this.varI18n[t][e]=this.mergeObject(r,this.varI18n[t][e]);var a},t.prototype.getHttpService=function(t,e,r){var a="?language="+e;return r.length>0&&(a+="&literals="+r.join()),t=t.lastIndexOf("/")===t.length-1?t.substr(0,t.length-1):t,this.http.get(t+a).map(function(t){return t.json()})},t.prototype.completeFaultLiterals=function(t,e,r,a){for(var n=0;n<r.length;n++){var o=r[n];a[o]||(a[o]=o)}return a},t.prototype.countObject=function(t){return Object.keys(t).length},t.prototype.mergeObject=function(t,e){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},t}();export{ThfI18nBaseService};function ThfI18nBaseService_tsickle_Closure_declarations(){ThfI18nBaseService.prototype.varI18n,ThfI18nBaseService.prototype.languageDefault,ThfI18nBaseService.prototype.contextDefault,ThfI18nBaseService.prototype.useCache,ThfI18nBaseService.prototype.servicesContext,ThfI18nBaseService.prototype.config,ThfI18nBaseService.prototype.http}
import{EventEmitter,Input,Optional,Output}from"@angular/core";import{NgControl,Validators}from"@angular/forms";import{convertDateToISOExtended,convertIsoToDate,convertToBoolean}from"../../../utils/index";import{ThfMask}from"../index";var ThfDatepickerBaseComponent=function(){function t(t){this.placeholder="",this.disabled=!1,this.readonly=!1,this.required=!1,this.focus=!1,this.clean=!1,this.errorPattern="",this.locale=navigator.language,this.onblur=new EventEmitter,this.onchange=new EventEmitter,this.onChangeModel=null,this.onTouchedModel=null,this.validators=[],this.firstStart=!0,this.ngControl=t}return Object.defineProperty(t.prototype,"setDisabled",{set:function(t){this.disabled=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setReadonly",{set:function(t){this.readonly=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setRequired",{set:function(t){var e=this;this.required=""===t||convertToBoolean(t),setTimeout(function(){e.required?e.controlModel(e.date):e.date?e.controlModel(e.date):e.onChangeModel("")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setFocus",{set:function(t){this.focus=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setClean",{set:function(t){this.clean=""===t||convertToBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setDateStart",{set:function(t){var e=this;t instanceof Date?this.start=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0):this.start=convertIsoToDate(t,!0,!1),setTimeout(function(){e.date&&e.controlModel(e.date)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setDateEnd",{set:function(t){var e=this;t instanceof Date?this.end=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59):this.end=convertIsoToDate(t,!1,!0),setTimeout(function(){e.date&&e.controlModel(e.date)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setFormat",{set:function(t){(t=t.toLowerCase()).match(/dd/)&&t.match(/mm/)&&t.match(/yyyy/)?this.format=t:this.format=this.locale.indexOf("en")>-1?"mm/dd/yyyy":"dd/mm/yyyy"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setLocale",{set:function(t){this.locale=t.length<2?"en":t},enumerable:!0,configurable:!0}),t.prototype.cleanInput=function(){},t.prototype.writeValue=function(t){},t.prototype.ngOnInit=function(){this.format||(this.format=this.locale.indexOf("en")>-1?"mm/dd/yyyy":"dd/mm/yyyy"),this.objMask=this.buildMask(),this.ngControl&&(this.ngControl.valueAccessor=this,this.required&&this.validators.push(Validators.required),this.validators.push(this.validate),this.ngControl.control.setValidators(this.validators))},t.prototype.getDateFromString=function(t){var e=parseInt(t.substring(this.format.indexOf("d"),this.format.indexOf("d")+2),10),o=parseInt(t.substring(this.format.indexOf("m"),this.format.indexOf("m")+2),10)-1,n=parseInt(t.substring(this.format.indexOf("y"),this.format.indexOf("y")+4),10),a=new Date(n,o,e);return a.getFullYear()===n&&a.getMonth()===o&&a.getDate()===e?a:null},t.prototype.formatToDate=function(t){var e=this.format;return e=(e=(e=e.replace("dd",("0"+t.getDate()).slice(-2))).replace("mm",("0"+(t.getMonth()+1)).slice(-2))).replace("yyyy",String(t.getFullYear()))},t.prototype.controlModel=function(t){t?(this.start&&this.end&&this.validateModel(t>=this.start&&t<=this.end,t),this.start&&!this.end&&this.validateModel(t>=this.start,t),this.end&&!this.start&&this.validateModel(t<=this.end,t),this.start||this.end||(this.date=t,this.callOnChange(convertDateToISOExtended(this.date,this.hour)))):(this.date=t,this.required?this.callOnChange("Data Inválida"):this.callOnChange(""))},t.prototype.validateModel=function(t,e){t?(this.date=e,this.callOnChange(convertDateToISOExtended(this.date,this.hour))):(this.date=e,this.callOnChange("Data fora do período"))},t.prototype.callOnChange=function(t){this.onChangeModel&&this.onChangeModel(t)},t.prototype.registerOnChange=function(t){this.onChangeModel=t},t.prototype.registerOnTouched=function(t){this.onTouchedModel=t},t.prototype.buildMask=function(){var t=this.format.toUpperCase();return t=(t=(t=t.replace(/DD/g,"99")).replace(/MM/g,"99")).replace(/YYYY/g,"9999"),new ThfMask(t,!0)},t.prototype.cleanModel=function(){this.callOnChange(""),this.cleanInput()},t.prototype.validate=function(t){return t.value&&isNaN(Date.parse(t.value))?{invalidDate:!0}:null},t.ctorParameters=function(){return[{type:NgControl,decorators:[{type:Optional}]}]},t.propDecorators={name:[{type:Input,args:["name"]}],placeholder:[{type:Input,args:["t-placeholder"]}],setDisabled:[{type:Input,args:["t-disabled"]}],setReadonly:[{type:Input,args:["t-readonly"]}],setRequired:[{type:Input,args:["t-required"]}],setFocus:[{type:Input,args:["t-focus"]}],setClean:[{type:Input,args:["t-clean"]}],errorPattern:[{type:Input,args:["t-error-pattern"]}],setDateStart:[{type:Input,args:["t-start"]}],setDateEnd:[{type:Input,args:["t-end"]}],setFormat:[{type:Input,args:["t-format"]}],setLocale:[{type:Input,args:["t-locale"]}],onblur:[{type:Output,args:["t-blur"]}],onchange:[{type:Output,args:["t-change"]}]},t}();export{ThfDatepickerBaseComponent};function ThfDatepickerBaseComponent_tsickle_Closure_declarations(){ThfDatepickerBaseComponent.ctorParameters,ThfDatepickerBaseComponent.propDecorators,ThfDatepickerBaseComponent.prototype.name,ThfDatepickerBaseComponent.prototype.placeholder,ThfDatepickerBaseComponent.prototype.disabled,ThfDatepickerBaseComponent.prototype.readonly,ThfDatepickerBaseComponent.prototype.required,ThfDatepickerBaseComponent.prototype.focus,ThfDatepickerBaseComponent.prototype.clean,ThfDatepickerBaseComponent.prototype.errorPattern,ThfDatepickerBaseComponent.prototype.start,ThfDatepickerBaseComponent.prototype.end,ThfDatepickerBaseComponent.prototype.format,ThfDatepickerBaseComponent.prototype.locale,ThfDatepickerBaseComponent.prototype.onblur,ThfDatepickerBaseComponent.prototype.onchange,ThfDatepickerBaseComponent.prototype.date,ThfDatepickerBaseComponent.prototype.onChangeModel,ThfDatepickerBaseComponent.prototype.onTouchedModel,ThfDatepickerBaseComponent.prototype.ngControl,ThfDatepickerBaseComponent.prototype.validators,ThfDatepickerBaseComponent.prototype.objMask,ThfDatepickerBaseComponent.prototype.firstStart,ThfDatepickerBaseComponent.prototype.hour}
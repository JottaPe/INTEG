!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@progress/kendo-angular-grid"),require("@totvs/thf-core/components/thf-button-base"),require("@angular/forms"),require("@progress/kendo-data-query"),require("@totvs/thf-core/components/thf-grid-base/thf-grid-base.component"),require("@totvs/thf-core/components/thf-modal-base")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@progress/kendo-angular-grid","@totvs/thf-core/components/thf-button-base","@angular/forms","@progress/kendo-data-query","@totvs/thf-core/components/thf-grid-base/thf-grid-base.component","@totvs/thf-core/components/thf-modal-base"],e):e(t["thf-grid"]={},t.core,t.common,t.kendoAngularGrid,t.thfButtonBase,t.forms,t.kendoDataQuery,t.thfGridBase_component,t.thfModalBase)}(this,function(t,e,o,n,r,a,i,s,d){"use strict";var l=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){t(e,o);function n(){this.constructor=e}e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),c=function(t){l(o,t);function o(){return null!==t&&t.apply(this,arguments)||this}return o.decorators=[{type:e.Component,args:[{selector:"thf-button",template:'<button class="thf-button" type="button" id="{{ id }}" [disabled]="disabled" [ngClass]="{ \'thf-button--primary\' : primary, \'thf-button--sm\' : small }" (click)="onClick()"> <span *ngIf="icon" class="thf-icon {{ icon }}" aria-hidden="true"></span> {{ label }} </button> ',providers:[]}]}],o.ctorParameters=function(){return[]},o}(r.ThfButtonBaseComponent),p=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[o.CommonModule],declarations:[c],exports:[c]}]}],t.ctorParameters=function(){return[]},t}(),u=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){t(e,o);function n(){this.constructor=e}e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),h=function(t){u(o,t);function o(o,n){var r=t.call(this)||this;return r.viewRef=o,r.renderer=n,r.sortable=!1,r.selectable=!1,r.editable=!1,r.groupable=!1,r.exportButtons=!1,r.showMoreDisabled="false",r.showRemoveButton=!1,r.addButton=!1,r.showMore=new e.EventEmitter,r.selectionChange=new e.EventEmitter,r.saveValue=new e.EventEmitter,r.editedRowIndex=-1,r.groups=[],r.state={skip:0},r.sort=[],r.addButtonCalled=!1,r.isCancelling=!1,r._parentRef=o._view.component,r.allData=r.allData.bind(r),r}return o.prototype.ngOnInit=function(){var t=this;if(this.renderer.listen("document","click",function(e){var o=e.target;t.validateSaveEventInDocument(o)}),this.data||(this.data=[]),this.columns?this.defineColumnType():this.columns=[],this.sortable&&(this.sortableObject={allowUnsort:this.sortable,mode:"single"}),this.groupable){for(var e=this.columns.length,o=0;o<e;o++){var n=this.columns[o];this.groups.length<2&&n.groupHeader&&this.groups.push({field:n.column})}this.sortableObject=null,this.loadDataGroupable()}else this.loadData();this.editable||(this.grid=null)},o.prototype.defineColumnType=function(){var t={number:function(t){t.type="numeric",t.format=void 0},currency:function(t){t.type="numeric",t.format="{0:c}"},date:function(t){t.type="date",t.format&&t.format.trim().length>0?t.format="{0:"+t.format+"}":t.format="{0:dd/MM/yyyy}"},string:function(t){t.type="text",t.format=void 0}};this.columns.forEach(function(e){e.type&&t.hasOwnProperty(e.type.trim().toLowerCase())?t[e.type.trim().toLowerCase()](e):e.type="text"})},o.prototype.isChildOf=function(t,e){for(;t&&t.parentElement;){if(this.hasClass(t.parentElement,e))return!0;t=t.parentElement}return!1},o.prototype.hasClass=function(t,e){return new RegExp(e).test(t.className)},o.prototype.validateSaveEventInDocument=function(t){this.isChildOf(t,"k-grid-content")||this.isChildOf(t,"k-grid-toolbar")||this.saveClick()},o.prototype.sortChange=function(t){this.sort=t,this.loadData()},o.prototype.dataStateChange=function(t){t.group.length>2&&t.group.splice(0,1),this.state=t,this.gridView=i.process(this.data,this.state)},o.prototype.updateIndex=function(t){for(var e=0,o=t.length;e<o;e++)this.data[e]=t[e]},o.prototype.loadData=function(){this.updateIndex(i.orderBy(this.data,this.sort)),this.gridView={data:this.data,total:this.data.length}},o.prototype.createFormGroup=function(){for(var t={},e=0;e<this.columns.length;e++){var o=this.columns[e];o.checkbox||(o.required?t[o.column]=new a.FormControl("",a.Validators.required):t[o.column]=new a.FormControl(""))}this.formGroup=new a.FormGroup(t)},o.prototype.addHandler=function(t){var e=t.sender;if(this.editedRowIndex>=0&&this.closeEditor(e,this.editedRowIndex),this.addButtonCalled=!0,this.createFormGroup(),this.addAction){if(!this.executeFunctionValidation(this.addAction,this.formGroup.value))return;this.formGroup.setValue(this.formGroup.value)}e.addRow(this.formGroup)},o.prototype.executeFunctionValidation=function(t,e){return t&&this._parentRef[t](e)},o.prototype.saveLine=function(){if(this.editable){var t=void 0;this.editedRowIndex>=0?(t=Object.assign(this.data[this.editedRowIndex],this.formGroup.value),this.data[this.editedRowIndex]=t):this.addButtonCalled&&this.formGroup&&(t=this.formGroup.value,this.data.push(t),this.addButtonCalled=!1),this.isGroup()&&this.loadDataGroupable(),this.saveValue.emit({data:t})}},o.prototype.editClickHandler=function(t){var e=t.rowIndex,o=t.dataItem;this.isValidForm()||(this.executeFunctionValidation(this.saveAction,{data:this.data[this.editedRowIndex]})&&this.saveLine(),this.isGroup()&&(e=this.getRowIndex(this.data,o)),this.editHandler({sender:this.grid,rowIndex:e,dataItem:o}))},o.prototype.getRowIndex=function(t,e){for(var o=Object.keys(e),n=0;n<t.length;n++){for(var r=!0,a=0,i=o;a<i.length;a++){var s=i[a];if(t[n][s]!==e[s]){r=!1;break}}if(r)return n}return-1},o.prototype.editHandler=function(t){var e=t.sender,o=t.rowIndex,n=t.dataItem;if(this.editable){this.closeEditor(e),this.editedProducted=Object.assign({},n),this.formGroup=new a.FormGroup({});for(var r=0,i=Object.keys(n);r<i.length;r++){var s=i[r],d=void 0,l=this.getColumn(s);l&&l.editable&&(d=l.required?new a.FormControl(n[s],a.Validators.required):new a.FormControl(n[s]),this.formGroup.addControl(s,d))}this.editedRowIndex=o,e.editRow(o,this.formGroup)}},o.prototype.saveClick=function(){if(this.addButtonCalled&&this.saveAction&&this.formGroup){if(!this.executeFunctionValidation(this.saveAction,{data:this.formGroup.value}))return}else if(this.editedRowIndex>=0&&this.saveAction&&!this.executeFunctionValidation(this.saveAction,{data:this.data[this.editedRowIndex]}))return void this.closeEditor(this.grid,this.editedRowIndex);this.isValidForm()||(this.saveLine(),this.closeEditor(this.grid),this.isGroup()?this.loadDataGroupable():this.loadData())},o.prototype.isGroup=function(){return this.groups&&this.groups.length>0},o.prototype.getColumn=function(t){for(var e=0;e<this.columns.length;e++){var o=this.columns[e];if(o.column===t)return o}},o.prototype.closeEditor=function(t,e){e=this.editedRowIndex,t&&t.closeRow(e),this.editedRowIndex=void 0,this.formGroup=void 0},o.prototype.saveHandler=function(t){var e=t.sender,o=t.rowIndex,n=t.formGroup,r=t.isNew,a=n.value;r&&!this.editable?this.data.push(a):this.data[o]=Object.assign(this.data[o],a),this.isGroup()?this.loadDataGroupable():this.loadData(),e.closeRow(o)},o.prototype.cancelPropagation=function(t){t.stopPropagation()},o.prototype.cancelHandler=function(t){var e=t.sender,o=t.rowIndex;null!=this.editedProducted&&(this.data[o]=this.editedProducted,this.editedProducted=null),this.isGroup()?this.loadDataGroupable():this.loadData(),this.closeEditor(e)},o.prototype.removeHandler=function(t){var e=t.rowIndex;this.removeAction&&!this.executeFunctionValidation(this.removeAction,{data:this.data[e]})||(this.data.splice(e,1),this.groupable?this.loadDataGroupable():this.loadData())},o.prototype.isValidForm=function(){return this.formGroup&&!this.formGroup.valid},o.prototype.allData=function(){return{data:i.process(this.data,{}).data}},o.prototype.changeValueCheckbox=function(t,e,o,n){this.editable?(o[n]=t.target.checked,this.data[e]=Object.assign(o),this.saveValue.emit({data:this.data[e]})):t.target.checked=!t.target.checked},o.prototype.onSelectionChange=function(t){this.selectionChange.emit({data:this.gridView.data[t.index]})},o.prototype.onShowMore=function(){this.showMore.emit(null),this.groupable?this.loadDataGroupable():this.loadData()},o.prototype.groupChange=function(t){this.groups=t,this.loadDataGroupable()},o.prototype.loadDataGroupable=function(){this.gridView=i.process(this.data,{group:this.groups}),this.dataArrayOrdered=[],this.getObjects(this.gridView.data),this.updateIndex(this.dataArrayOrdered)},o.prototype.getObjects=function(t){var e=this;t.forEach(function(t){t.items instanceof Array?e.getObjects(t.items):e.dataArrayOrdered.push(t)})},o.decorators=[{type:e.Component,args:[{selector:"thf-grid",encapsulation:e.ViewEncapsulation.None,template:'<kendo-grid  [data]="gridView"  [sortable]="sortableObject" [sort]="sort" [groupable]="groupable" [group]="groups" [selectable]="selectable" (dataStateChange)="dataStateChange($event)" (groupChange)="groupChange($event)" (selectionChange)="onSelectionChange($event)" (sortChange)="sortChange($event)" (add)="addHandler($event)" (cancel)="cancelHandler($event)" (cellClick)="editClickHandler($event)" (edit)="editHandler($event)" (remove)="removeHandler($event)" (save)="saveHandler($event)" style="height: 70%"> <kendo-grid-messages  i18n-noRecords="" noRecords="Não há registros" i18n-groupPanelEmpty="" groupPanelEmpty="Arraste a coluna até o cabeçalho e solte para agrupar por esta coluna"> </kendo-grid-messages> <ng-template kendoGridToolbarTemplate *ngIf="addButton || exportButtons" > <button kendoGridAddCommand *ngIf="addButton" class="k-primary">Adicionar</button> <button type="button" kendoGridExcelCommand *ngIf="exportButtons" ><span class="k-icon k-i-file-excel"></span></button> <button kendoGridPDFCommand *ngIf="exportButtons"><span class=\'k-icon k-i-file-pdf\'></span></button> </ng-template> <kendo-grid-column *ngFor="let col of columns; let i = index" [field]="col.column" [title]="col.label" [width]="col.width" [filter]="col.filter" [format]="col.format" [editor]="col.type"> <ng-template kendoGridCellTemplate let-data *ngIf="col.checkbox" let-rowIndex="rowIndex"> <input type="checkbox" id="chkbox_{{rowIndex}}" name="chkbox_{{col.column}}_{{rowIndex}}" [checked]="data[col.column]" (change)="changeValueCheckbox($event, rowIndex, data, col.column)" class="thf-grid thf-grid-checkbox" /> <label for="chkbox_{{rowIndex}}"></label> </ng-template> <ng-template kendoGridGroupHeaderTemplate let-value="value" *ngIf="col.groupHeader"> {{value}} </ng-template> </kendo-grid-column> <kendo-grid-command-column title="" width="80"> <ng-template kendoGridCellTemplate let-isNew="isNew"> <button kendoGridRemoveCommand class="k-primary" *ngIf="showRemoveButton" >Remover</button> <button kendoGridCancelCommand class="k-primary" (click)="cancelPropagation($event)">{{ isNew ? \'Descartar\' : \'Cancelar\' }} </button> </ng-template> </kendo-grid-command-column> <kendo-grid-excel fileName="spreadsheet.xlsx" [fetchData]="allData"></kendo-grid-excel> <kendo-grid-pdf fileName="grid.pdf" [allPages]="true"> <kendo-grid-pdf-margin top="1cm" left="1cm" right="1cm" bottom="1cm"></kendo-grid-pdf-margin> </kendo-grid-pdf> </kendo-grid> <div class="thf-grid-show-more" *ngIf="showMore.observers.length > 0"> <div style="text-align: center;"> <thf-button t-label="Carregar mais resultados" (t-click)="onShowMore()" t-id="btnShowMoreId" [t-disabled]="showMoreDisabled"></thf-button> </div> </div> ',styles:[".k-grid .k-state-selected { background-color: skyblue !important; color: #000000; } .k-grid .k-alt.k-state-selected { background-color: skyblue !important; color: #000000; } .thf-grid.thf-grid-checkbox { width: 20px; height: 20px; border-radius: 2px; box-shadow: inset 0 1px 8px 0 rgba(0, 0, 0, 0.1); border: solid 1px rgba(255, 255, 255, 0.6); } .thf-grid.thf-grid-checkbox:checked { width: 20px; height: 20px; border-radius: 2px; } input[type=checkbox] { visibility: hidden; position: absolute; } input[type=checkbox] + label:before { width: 20px; height: 20px; margin-top: -2px; margin-right: 8px; display: inline-block; vertical-align: middle; background-color: #ffffff; box-shadow: inset 0px 2px 8px 0 #edefef; border: solid 1px #b7bebf; content: ' '; } input[type=checkbox]:checked + label:before { background-color: #0c9abe; box-shadow: none; color: white; font-family: 'TotvsIcon' !important; line-height: 18px; content: '\\e937'; padding-left: 1px; } input[type=checkbox]:disabled + label:before { background-color: #edefef; border: solid 1px #b7bebf; } input[type=checkbox]:checked:disabled + label:before { color: #b7bebf; border: solid 1px #b6bdbf; } input[type=checkbox] + label:before { border-radius: 2px; } .thf-grid-show-more { width: 100%; margin-top: 10px; margin-bottom: 10px; } "]}]}],o.ctorParameters=function(){return[{type:e.ViewContainerRef},{type:e.Renderer2}]},o.propDecorators={columns:[{type:e.Input,args:["t-columns"]}],sortable:[{type:e.Input,args:["t-sortable"]}],selectable:[{type:e.Input,args:["t-selectable"]}],editable:[{type:e.Input,args:["t-editable"]}],groupable:[{type:e.Input,args:["t-groupable"]}],exportButtons:[{type:e.Input,args:["t-show-export-buttons"]}],showMoreDisabled:[{type:e.Input,args:["t-show-more-disabled"]}],showRemoveButton:[{type:e.Input,args:["t-show-remove-button"]}],addButton:[{type:e.Input,args:["t-show-add-button"]}],saveAction:[{type:e.Input,args:["t-save-action"]}],removeAction:[{type:e.Input,args:["t-remove-action"]}],addAction:[{type:e.Input,args:["t-add-action"]}],showMore:[{type:e.Output,args:["t-show-more"]}],selectionChange:[{type:e.Output,args:["t-selection-change"]}],saveValue:[{type:e.Output,args:["t-save-value"]}],grid:[{type:e.ViewChild,args:[n.GridComponent]}]},o}(s.ThfGridBaseComponent),f=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){t(e,o);function n(){this.constructor=e}e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),m=function(t){f(o,t);function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.focusableElements="input, select, textarea, button, a",e}return o.prototype.open=function(){t.prototype.open.call(this),this.handleFocus()},o.prototype.close=function(){t.prototype.close.call(this),document.removeEventListener("focus",this.focusFunction,!0)},o.prototype.handleFocus=function(){var t=this;setTimeout(function(){t.modalContent&&(t.initFocus(),document.addEventListener("focus",t.focusFunction,!0))})},o.prototype.initFocus=function(){var t=this;if(this.focusFunction=function(e){t.modalContent.nativeElement.contains(e.target)||(e.stopPropagation(),t.firstElement.focus())},this.setFirstElement(),this.hideClose)this.firstElement.focus();else{this.modalContent.nativeElement.querySelectorAll(this.focusableElements)[1].focus()}},o.prototype.setFirstElement=function(){this.firstElement=this.modalContent.nativeElement.querySelector(this.focusableElements)},o.decorators=[{type:e.Component,args:[{selector:"thf-modal",template:'<div class="thf-modal" *ngIf="!isHidden"> <div class="thf-modal-overlay" (click)="onClickOut()"></div> <div #modalContent class="thf-modal-content thf-modal-{{ modalSize }}" tabindex="-1"> <div class="thf-modal-header"> <div class="thf-modal-title"> <a class="thf-modal-header-close-button" *ngIf="!hideClose" (click)="close()" tabindex="0" > <span class="thf-icon thf-icon-close"></span> </a> {{ title }} </div> </div> <div class="thf-modal-body"> <ng-content></ng-content> </div> <div class="thf-modal-footer"> <thf-button *ngIf="secondaryAction" class="thf-modal-footer-button" [t-label]="secondaryAction.label" (t-click)="secondaryAction.action()" t-primary="false"> </thf-button> <thf-button *ngIf="primaryAction" class="thf-modal-footer-button" [t-label]="primaryAction.label" (t-click)="primaryAction.action()" t-primary="true"> </thf-button> </div> </div> </div> ',styles:[".thf-modal { font-family: NunitoSans; position: relative; z-index: 50; } .thf-modal-overlay:before { content: ''; position: fixed; background-color: #052e3e; top: 0; bottom: 0; right: 0; left: 0; opacity: 0.7; } .thf-modal-sm { width: 50% !important; } .thf-modal-md { width: 70% !important; } .thf-modal-lg { width: 80% !important; } .thf-modal-xl { width: 90% !important; } .thf-modal-auto { width: auto !important; } @media screen and (max-width: 480px) { .thf-modal-content { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); background-color: #ffffff; box-shadow: 0px 4px 16px 0 rgba(7, 9, 9, 0.24); max-height: 90%; width: 90%; } } @media screen and (min-width: 481px) and (max-width: 960px) { .thf-modal-content { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); background-color: #ffffff; box-shadow: 0px 4px 16px 0 rgba(7, 9, 9, 0.24); max-height: 90%; width: 80%; } } @media screen and (min-width: 961px) { .thf-modal-content { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); background-color: #ffffff; box-shadow: 0px 4px 16px 0 rgba(7, 9, 9, 0.24); max-height: 90%; width: 70%; } } .thf-modal-header { border-radius: 3px; padding-top: 18px; padding-left: 24px; padding-right: 24px; padding-bottom: 12px; border: 0px; } .thf-modal-title { font-size: 34px; font-weight: 200; line-height: 27px; text-align: left; color: #4a5c60; } .thf-modal-header-close-button { float: right; border-radius: 1px; text-align: right; color: #0c9abe; cursor: pointer; text-decoration: none; } .thf-modal-body { margin: 12px 24px 12px 24px; font-size: 14px; line-height: 1.71; text-align: left; color: #425357; max-height: calc(100vh - 210px); overflow-y: auto; } .thf-modal-footer { font-family: NunitoSans; background-color: #ffffff; border-radius: 3px; border: 0px; text-align: right; padding-top: 12px; padding-left: 0px; padding-bottom: 24px; padding-right: 24px; } .thf-modal-footer-button { margin-left: 16px; margin-top: 5px; } ::-webkit-scrollbar { width: 4px; height: 50px; opacity: 0.5; border-radius: 2px; } ::-webkit-scrollbar-thumb { background-color: #0c9abe; } "]}]}],o.ctorParameters=function(){return[]},o.propDecorators={modalContent:[{type:e.ViewChild,args:["modalContent",{read:e.ElementRef}]}]},o}(d.ThfModalBaseComponent),g=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[o.CommonModule,p],declarations:[m],exports:[m],providers:[]}]}],t.ctorParameters=function(){return[]},t}(),b=function(t,e){return new RegExp(e).test(t.className)},x=function(t,e){for(;t&&t.parentElement;){if(b(t.parentElement,e))return!0;t=t.parentElement}return!1},y=function(t,e){return t.toLowerCase()===e.toLowerCase()},v=function(){function t(t,o){this.el=t,this.renderer=o,this.editRow=new e.EventEmitter,this.saveRow=new e.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;this.renderer.listen(this.el.nativeElement,"click",function(e){var o=e.target,n=function(t,e){for(;t&&t.parentElement;){if(y(t.nodeName,e)||y(t.parentElement.nodeName,e))return t.parentElement;t=t.parentElement}return null}(o,"tr");n&&!b(n,"k-grid-edit-row")&&x(o,"k-grid-content")&&t.editRow.emit(n.rowIndex)}),this.renderer.listen("document","click",function(e){var o=e.target;x(o,"k-grid-content")||x(o,"k-grid-toolbar")||t.saveRow.emit()})},t.decorators=[{type:e.Directive,args:[{selector:"[row-click]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2}]},t.propDecorators={editRow:[{type:e.Output}],saveRow:[{type:e.Output}]},t}(),w=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[o.CommonModule,n.GridModule,n.ExcelModule,n.PDFModule,p,g],declarations:[h,v],exports:[h],providers:[],schemas:[]}]}],t.ctorParameters=function(){return[]},t}();t.ThfGridModule=w,Object.defineProperty(t,"__esModule",{value:!0})});
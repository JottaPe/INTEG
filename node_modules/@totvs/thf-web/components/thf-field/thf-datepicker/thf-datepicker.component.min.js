var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){t(e,i);function n(){this.constructor=e}e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();import{Component,ElementRef,HostListener,Input,Optional,Renderer,ViewChild,ViewEncapsulation}from"@angular/core";import{NgControl}from"@angular/forms";import{convertDateToISOExtended,isMobile}from"@totvs/thf-core/utils";import{ThfDatepickerBaseComponent}from"@totvs/thf-core/components/thf-field-base";var ThfDatepickerComponent=function(t){__extends(e,t);function e(e,i,n){var o=t.call(this,n)||this;return o.validators=[],o.date=new Date,o.hour="T00:00:00+00:00",o.el=i,o.clickListener=e.listenGlobal("document","click",function(t){return o.wasClickedOnPicker(t)}),o}return e.prototype.ngAfterViewInit=function(){this.focus&&this.inputEl.nativeElement.focus(),this.clean&&(this.inputEl.nativeElement.style.paddingRight="30px")},e.prototype.ngOnDestroy=function(){this.clickListener()},e.prototype.togglePicker=function(){var t=this.dialogPicker.nativeElement;if(!this.disabled)if(t.classList.contains("thf-datepicker-invisible")){var e=document.body.scrollWidth;t.style.marginLeft="0px",t.classList.remove("thf-datepicker-invisible"),this.picker.init(),document.body.scrollWidth!==e&&(t.style.marginLeft=this.inputEl.nativeElement.offsetWidth-288+"px")}else t.classList.add("thf-datepicker-invisible"),this.inputEl.nativeElement.disabled=!1},e.prototype.dateSelected=function(){this.inputEl.nativeElement.value=this.formatToDate(this.date),this.callOnChange(convertDateToISOExtended(this.date,this.hour)),this.dialogPicker.nativeElement.classList.add("thf-datepicker-invisible")},e.prototype.wasClickedOnPicker=function(t){this.dialogPicker.nativeElement.contains(t.target)&&!this.hasOverlayClass(t.target)||this.iconDatepicker.nativeElement.contains(t.target)||this.dialogPicker.nativeElement.classList.add("thf-datepicker-invisible")},e.prototype.onKeyup=function(t){this.objMask.keyup(t),this.objMask.valueToModel||""===this.objMask.valueToModel?this.objMask.valueToModel.length>=10?(this.controlModel(this.getDateFromString(this.inputEl.nativeElement.value)),this.date=this.getDateFromString(this.inputEl.nativeElement.value)):(this.date=void 0,this.controlModel(this.date)):this.date=void 0},e.prototype.onKeypress=function(t){this.objMask.keypress(t)},e.prototype.onKeydown=function(t){this.objMask.keydown(t)},e.prototype.hasInvalidClass=function(){return this.el.nativeElement.classList.contains("ng-invalid")&&this.el.nativeElement.classList.contains("ng-dirty")&&""!==this.inputEl.nativeElement.value},e.prototype.cleanInput=function(){this.inputEl.nativeElement.value="",this.callOnChange(""),this.date=void 0,this.required&&this.controlModel(this.date)},e.prototype.eventOnBlur=function(t){isMobile()||(this.objMask.blur(t),this.onblur.emit(),this.objMask.valueToModel?this.objMask.valueToModel.length>=10?(this.controlModel(this.getDateFromString(this.inputEl.nativeElement.value)),this.date=this.getDateFromString(this.inputEl.nativeElement.value)):(this.date=void 0,this.controlModel(this.date)):this.date=void 0)},e.prototype.eventOnChange=function(t){isMobile()&&(this.controlModel(this.inputEl.nativeElement.value),this.callOnChange(this.inputEl.nativeElement.value)),this.onchange.emit()},e.prototype.eventOnClick=function(t){var e=this;isMobile()?(t.target.blur(),setTimeout(function(){return e.togglePicker()},0)):this.objMask.click(t)},e.prototype.formatToDate=function(t){var e=this.format;return e=(e=(e=e.replace("dd",("0"+t.getDate()).slice(-2))).replace("mm",("0"+(t.getMonth()+1)).slice(-2))).replace("yyyy",String(t.getFullYear()))},e.prototype.writeValue=function(t){if(this.inputEl&&t){if(t instanceof Date){var e=t.toString();this.hour="T"+e.substring(16,24)+e.substring(28,31)+":"+e.substring(31,33),this.date=t,this.inputEl.nativeElement.value=this.formatToDate(t)}else{this.hour=t.substring(10,25);var i=parseInt(t.substring(8,10),10),n=parseInt(t.substring(5,7),10)-1,o=parseInt(t.substring(0,4),10),a=new Date(o,n,i);this.date=a,this.inputEl.nativeElement.value=this.formatToDate(a)}this.controlModel(this.date)}},e.prototype.hasOverlayClass=function(t){return t.classList.contains("thf-calendar-overlay")},e.decorators=[{type:Component,args:[{selector:"thf-datepicker",template:'<div class="thf-input-datepicker"> <thf-field-container [t-label]="label" [t-help]="help" [t-opcional]="!required"> <div class="thf-field-flex-container" > <input #inp type="text" class="thf-input-elem" (blur)="eventOnBlur($event)" (change)="eventOnChange($event)" (click)="eventOnClick($event)" [attr.name]="name" [placeholder]="placeholder" [required]="required" [disabled]="disabled" [readonly]="readonly"> <thf-clean #clean (click)="cleanInput()" position="2" *ngIf="clean && !disabled"></thf-clean> <span #iconDatepicker (click)="togglePicker()" class="thf-icon thf-icon-calendar thf-span-datepicker"></span> </div> <div class="thf-datepicker thf-datepicker-invisible" #dialogPicker> <thf-calendar #picker [t-locale]="locale" [t-end]="end" [t-start]="start" [(t-date)]="date" (t-submit)="dateSelected()"> </thf-calendar> </div> <div class="thf-field-error"> <div *ngIf="errorPattern!==\'\' && hasInvalidClass()" class="thf-field-error"> <span class="thf-icon thf-icon-close"></span> {{ errorPattern }} </div> </div> </thf-field-container> </div> ',styles:[".thf-input-datepicker { max-width: 100%; } .thf-clean-arrow-mobile { z-index: 4; position: relative; width: 20px; float: right; height: 20px; background-color: white; bottom: 33px; right: 2px; } .thf-input-elem { width: 100%; line-height: 24px; font-family: NunitoSans; font-size: 16px; border-radius: 3px; background-color: #ffffff; box-shadow: inset 0px 2px 8px 0 #edefef; border: solid 1px #b7bebf !important; padding: 10px 15px 8px 15px; margin-top: 8px; } .thf-input-elem:disabled { background-color: #edefef; border: solid 1px #b7bebf; } thf-datepicker.ng-valid .thf-input-elem:focus { outline: none; border: solid 1px #0c9abe !important; border: solid 1px var(--water-blue); } thf-datepicker.ng-invalid.ng-dirty .thf-input-elem { outline: none; border: solid 1px #c64840 !important; } thf-datepicker.ng-invalid.ng-dirty .thf-span-clean { color: #c64840 !important; } .thf-field-flex-container { display: flex; } .thf-text-clean { position: absolute; width: 0px; font-size: 25px; color: #0c9abe; right: 35px; top: 10px; text-decoration: none; cursor: pointer; } .thf-field-error { display: block; height: 20px; font-family: NunitoSans; font-size: 12px; text-align: left; color: #c64840; padding-left: 2px; margin-top: 2px; } .thf-field-error span { padding-bottom: 2px; vertical-align: middle; font-size: 14px; font-weight: bold; } .thf-datepicker { position: absolute; padding-top: 8px; z-index: 1000; } .thf-datepicker-invisible { display: none; } .thf-span-datepicker { position: relative; width: 0px; font-size: 25px; color: #0c9abe; right: 35px; top: 18px; text-decoration: none; z-index: 100; cursor: pointer; } thf-datepicker.ng-invalid.ng-dirty .thf-span-datepicker { color: #c64840 !important; } "],encapsulation:ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:Renderer},{type:ElementRef},{type:NgControl,decorators:[{type:Optional}]}]},e.propDecorators={picker:[{type:ViewChild,args:["picker"]}],dialogPicker:[{type:ViewChild,args:["dialogPicker",{read:ElementRef}]}],iconDatepicker:[{type:ViewChild,args:["iconDatepicker",{read:ElementRef}]}],inputEl:[{type:ViewChild,args:["inp",{read:ElementRef}]}],cleanEl:[{type:ViewChild,args:["clean",{read:ElementRef}]}],label:[{type:Input,args:["t-label"]}],help:[{type:Input,args:["t-help"]}],onKeyup:[{type:HostListener,args:["keyup",["$event"]]}],onKeypress:[{type:HostListener,args:["keypress",["$event"]]}],onKeydown:[{type:HostListener,args:["keydown",["$event"]]}]},e}(ThfDatepickerBaseComponent);export{ThfDatepickerComponent};function ThfDatepickerComponent_tsickle_Closure_declarations(){ThfDatepickerComponent.decorators,ThfDatepickerComponent.ctorParameters,ThfDatepickerComponent.propDecorators,ThfDatepickerComponent.prototype.picker,ThfDatepickerComponent.prototype.dialogPicker,ThfDatepickerComponent.prototype.iconDatepicker,ThfDatepickerComponent.prototype.inputEl,ThfDatepickerComponent.prototype.cleanEl,ThfDatepickerComponent.prototype.label,ThfDatepickerComponent.prototype.help,ThfDatepickerComponent.prototype.validators,ThfDatepickerComponent.prototype.date,ThfDatepickerComponent.prototype.hour,ThfDatepickerComponent.prototype.el,ThfDatepickerComponent.prototype.clickListener}